version: '3.8'

services:
  gha-analyzer:
    # Use the pre-built image from Docker Hub or build locally
    # Uncomment the 'image' line to use pre-built image
    # image: username/gha-performance-analyzer:latest
    
    # Uncomment the 'build' section to build from local Dockerfile
    build:
      context: .
      dockerfile: Dockerfile
    
    # Port mapping: host:container
    ports:
      - "5001:5000"
    
    # Environment variables for configuration
    environment:
      # Option 1: Set GitHub token via environment variable
      # Uncomment and set your token here or use a .env file
      # - GITHUB_TOKEN=ghp_your_github_token_here
      
      # Option 2: Leave unset and configure via web interface
      # The token will be stored persistently in the data volume
      - GITHUB_TOKEN=${GITHUB_TOKEN:-}
    
    # Named volumes for persistent data storage
    volumes:
      # Database and configuration files
      - gha-data:/app/data
      
      # Cached API responses
      - gha-cache:/app/cache
      
      # Generated reports and exports
      - gha-reports:/app/reports
      
      # Alternative: Use bind mounts to access files directly on host
      # Uncomment these and comment out the named volumes above
      # - ./data:/app/data
      # - ./cache:/app/cache
      # - ./reports:/app/reports
    
    # Restart policy: automatically restart container unless explicitly stopped
    restart: unless-stopped
    
    # Optional: Set container name
    container_name: gha-performance-analyzer
    
    # Optional: Resource limits
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1.0'
    #       memory: 1G
    #     reservations:
    #       cpus: '0.5'
    #       memory: 512M

# Named volumes definition
volumes:
  gha-data:
    driver: local
  gha-cache:
    driver: local
  gha-reports:
    driver: local
